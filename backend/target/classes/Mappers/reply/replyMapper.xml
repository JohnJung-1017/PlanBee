<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.pj.planbee.mapper.ReplyMapper"> <!-- 여기가 사용할 매퍼를 연결해주는 역할, 경로주의 -->
	<resultMap type="com.pj.planbee.dto.ReplyDTO" id="reply">
		<id property="replyId" column="reply_id" /> 
		<result property="postId" column="post_id" /> <!-- PK로 지정한 것은 id로 받아준다 -->
		<result property="userId" column="user_id" />
		<result property="replyContent" column="reply_content" />
		<result property="replyDate" column="reply_date" />
		<result property="repReplyId" column="rep_reply_id" />
	</resultMap>
	
	<!-- 댓글 등록 -->
    <insert id="insertReply">
 		INSERT INTO reply (post_id, user_id, reply_content, rep_reply_id)VALUES (#{postId}, #{userId}, #{replyContent}, #{repReplyId})
    </insert>

    <!-- 특정 게시글의 댓글 목록 조회 -->
    <select id="getRepliesByPostId" resultMap="reply">
        SELECT * FROM reply WHERE post_id = #{postId} ORDER BY rep_reply_id ASC, reply_date ASC
    </select>

    <!-- 댓글 수정 -->
    <update id="updateReply">
        UPDATE reply SET reply_content = #{replyContent} WHERE reply_id = #{replyId} AND post_id = #{postId} AND user_id = #{userId}
    </update>

    <!-- 댓글 삭제 -->
    <delete id="deleteReply">
        DELETE FROM reply WHERE reply_id = #{replyId} AND post_id = #{postId} AND user_id = #{userId}
    </delete>

</mapper>